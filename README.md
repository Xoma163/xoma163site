## VkBot Petrovich

Этот проект бот ВКонтакте, созданный в первую очередь для личных целей, но так вышло, что и для развлечения.

### FAQ

---

Q: **Где лежит сам бот в этом django проекте?**

A: apps/API_VK/. Обработка запросов - vkbot.py, API - views.py, команды - command/

---

Q: **Куда контрибьютить свою команду?**

A: В папке apps/API_VK/command/commands/ нужно добавить свою команду, унаследованную от CommonCommand. 
Команду следует положить в ту папку, в которую она подходит логически (пример: команда для админа в AdminCommands, простая команда с простым ответом - EasyCommands, Игра - Games, ...)

---

Q: **Правила оформления команд**

A : Любая команда должна содержать метод init внутри которой происходит инициализация команды. Обязательным параметром является список names - имена, на которые будет откликаться команда.

Возможные параметры конструктора:
- names - обязательное поле, имена команды. Список
- help_text - текст отображения в команде /помощь
- detail_help_text - текст отображения в команде /помощь (имя команды)
- keyboard - вывод кнопки(ок) на клавиатуру
- access - требуемый уровень прав для использования команды (user/student/terraria/minecraft/moderator/admin)
- pm - команда будет работать только в лс
- conversation - команда будет работать только в конфе
- fwd - требуются пересылаемые сообщения
- args - требуются аргументы (количество в int)
- int_args - требуются int аргументы (список, указать позиции)
- api - будет ли команда работать для API (по умолчанию True) 
- attachments - требуются ли вложения 

Список полей конструктора может отличаться от вышеуказанного. Уточняйте в CommonCommand

Также должен быть переопределён метод start, в котором содержится тело команды.

Внутри любой команды есть две переменные - vk_bot и vk_event

#### vk_bot
Данная переменная - экземпляр VkBot со всеми методами для работы. Вероятность того, что потребуется в работе команд - 5%

#### vk_event
Данная переменная - экземпляр VkEvent со всеми полями, необходимыми для работы. 

- sender - сущность VkUser, который отправил сообщение
- chat  - сущность VkChat, из которого отправили сообщение (при наличии)
- peer_id - куда отправлять ответ (для юзеров - id, для чатов - 2000000000 + chat_id(у каждого чата уникален и начинается с 1))
- payload - скрытая информация с клавиатур
- msg - полное сообщение без изменений
- command - команда
- args - аргументы(список) (при наличии) 
- original_args - аргументы без команды и ключей (строка) (при наличии)
- keys - ключи (словарь) (при наличии)
- keys_list - ключи (список) (при наличии)
- params - аргументы + ключи. Короче говоря всё, кроме команды (строка) (при наличии)
- params_without_keys - Я сам не знаю что это до конца 
- attachments - вложения (словарь)
- fwd - пересланные сообщения (словарь)
- from_chat - True если сообщение из чата 
- from_user - True если сообщение от юзера
- api - True если сообщение из API

Список полей VkEvent может отличаться от вышеуказанного. Уточняйте в VkEvent(vk_bot.py)

#### Формат fwd
[{'text':'...','from_id':'...'},...]
- text - Текст сообщения
- from_id - если положительный, то от пользователя, если отрицательный, то это group_id бота

#### Формат attachments
Для изображений 'type_name':'photo'. Остальные типы пока не поддерживаются

[{'type_name':{'url':'...','size':{'width':'...','height'...'}}}]

--- 

Q: **Как возвращать ответ команды?**

A:
- return "сообщение" - отправляет одно сообщение
- return {'msg':'сообщение', 'attachments':'[вложения]','keyboard':'[клавиатура]'} (в таком виде обязателен только msg) - отправляет вложение или клавиатуру
- return ['сообщение1','сообщение2',...]
- return [{'msg':'сообщение', 'attachments':'[вложения]','keyboard':'[клавиатура]'},{...},...] - отправляет несколько сообщений подряд с вложениями или клавиатурой

---

Q: **Как работать с API?**

A: https://api.xoma163.xyz/

Обязательные параметры
- msg - сообщение боту

Дополнительные параметры
- test=False - отправляет сообщение в тестовую конфу
- send=True - отправляет сообщение в конфу или нет 
- from_chat=True - отправляет сообщение в конфу. Если False, то в лс

OAuth пока не работает, скоро прикрутим

https://api.xoma163.xyz/chat

Обязательные параметры
- msg - сообщение боту

Дополнительные параметры
- test=False - отправляет сообщение в тестовую конфу